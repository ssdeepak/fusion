import{b as R,i as ee,j as U,k as te,l as ie,m as ne,n as re,o as oe,p as ae,q as se}from"./chunk-2SUXZRV6.js";import"./chunk-4OGH6Q66.js";import"./chunk-6D2PQ4BF.js";import{a as de}from"./chunk-6BM6YNJB.js";import{a as q,c as X,d as Z}from"./chunk-STP3VB3D.js";import"./chunk-3MICEEYE.js";import{b as w,g as Y,i as J,x as T,y as Q}from"./chunk-TL3SOKZG.js";import{o as G}from"./chunk-2UOGX6KS.js";import{g as L,i as N,j as K}from"./chunk-FB7CDEED.js";import{$a as I,Ia as V,Na as S,Oa as A,Pa as m,Pb as j,Qa as P,Ua as b,V as $,Va as M,Xa as D,Ya as F,Za as c,_a as p,ba as h,ca as u,cb as g,da as W,db as f,ea as O,eb as s,mb as E,ob as H,ya as _,yb as z,za as k,zb as B}from"./chunk-XIWENJHJ.js";import{i as x}from"./chunk-BL3FZZIZ.js";var ce=()=>[".."];function pe(o,l){if(o&1){let n=g();c(0,"mnu",20),f("dataChanged",function(e){h(n);let i=s(4);return u(i.saveAndClose(e))})("onClicked",function(e){h(n);let i=s(4);return u(i.openMenuAndScroll(e))}),p()}if(o&2){let n=l.$implicit;m("data",n)}}function he(o,l){if(o&1&&(c(0,"div")(1,"div",19),D(2,pe,1,1,":xhtml:mnu",10,M),p()()),o&2){let n=s(2).$implicit,t=s();P("max-height",n.h-20,"px")("overflow-y","auto"),_(2),F(t.menus())}}function ue(o,l){if(o&1){let n=g();c(0,"vanilla-builder",21),f("itemChanged",function(e){h(n);let i=s(3);return u(i.setCurrent(e))})("rootUpdated",function(e){h(n);let i=s(3);return u(i.updateRoot(e))})("sourceChanged",function(e){h(n);let i=s(3);return u(i.sourceChanged(e))}),p()}if(o&2){let n=s(2).$implicit,t=s();m("data",t.root)("h",n.h)("current",t.current())}}function _e(o,l){if(o&1){let n=g();c(0,"ast-canvas",22),f("rootUpdated",function(e){h(n);let i=s(3);return u(i.updateRoot(e))})("itemChanged",function(e){h(n);let i=s(3);return u(i.setCurrent(e))}),p()}if(o&2){let n=s(2).$implicit,t=s();m("data",t.root)("current",t.current())("w",n.w)("h",n.h-50)}}function me(o,l){if(o&1){let n=g();c(0,"pickers",23),f("dataEdited",function(e){h(n);let i=s(3);return u(i.dataUpdated(e))}),p()}if(o&2){let n=s(2).$implicit,t=s();m("data",t.current())("root",t.root)("w",n.w)("h",n.h-50)}}function xe(o,l){if(o&1){let n=g();c(0,"diagrams",23),f("dataEdited",function(e){h(n);let i=s(3);return u(i.dataUpdated(e))}),p()}if(o&2){let n=s(2).$implicit,t=s();m("data",t.current())("root",t.root)("w",n.w)("h",n.h-50)}}function fe(o,l){if(o&1){let n=g();c(0,"chat-forms",23),f("dataEdited",function(e){h(n);let i=s(3);return u(i.dataUpdated(e))}),p()}if(o&2){let n=s(2).$implicit,t=s();m("data",t.current())("root",t.root)("w",n.w)("h",n.h-50)}}function ge(o,l){if(o&1&&I(0,"runner",18),o&2){let n=s(3);m("root",n.root)}}function we(o,l){if(o&1){let n=g();W(),c(0,"g",13),f("reIndexed",function(e){h(n);let i=s(2);return u(i.reindexItem(e))}),O(),c(1,"div",6),S(2,he,4,4,":xhtml:div",14)(3,ue,1,3,":xhtml:vanilla-builder",15)(4,_e,1,4,":xhtml:ast-canvas",16)(5,me,1,4,":xhtml:pickers",17)(6,xe,1,4,":xhtml:diagrams",17)(7,fe,1,4,":xhtml:chat-forms",17)(8,ge,1,1,":xhtml:runner",18),p()()}if(o&2){let n=s().$implicit,t=s();m("data",n)("current",t.menu()),A("data-id",n.id),_(),P("width",n.w,"px")("height",n.h,"px"),_(),b(n.role==="Root"?2:n.role==="Builder"?3:n.role==="Canvas"?4:n.role==="Picker"?5:n.role==="Diagram"?6:n.role==="Edit"?7:n.role==="Runner"?8:-1)}}function Ce(o,l){if(o&1&&S(0,we,9,8,":svg:g",12),o&2){let n=l.$implicit;b(n.isOpen?0:-1)}}function ve(o,l){if(o&1){let n=g();c(0,"menu-toggle",24),f("menuToggled",function(e){h(n);let i=s();return u(i.menuToggled(e))}),p()}if(o&2){let n=l.$implicit;m("data",n)}}function ye(o,l){if(o&1){let n=g();c(0,"div",11)(1,"mnu",25),f("dataChanged",function(e){h(n);let i=s();return u(i.saveAndClose(e))}),p()()}if(o&2){let n=s();_(),m("data",n.menu())}}var Qe=(()=>{let l=class l{constructor(t,e,i,a){this.store=t,this.service=e,this.route=i,this.nav=a,this.root=new R,this.plan=new J,this.current=V(new Y),this.menus=V([]),this.customOn=V(!1),this.menu=V(new w),this.maxW=window.innerWidth-20,this.w=window.innerWidth-20,this.h=window.innerHeight-20,this.rootMenu=j(()=>this.menus().find(d=>d.role==="Root")),window.addEventListener("resize",()=>{this.placeShapes()})}ngOnInit(){return x(this,null,function*(){let t=this.route.snapshot.params.id;t&&(yield this.loadMenus("Plan"),this.service.getPlan(t).subscribe(e=>x(this,null,function*(){this.plan=e,this.parseCode()})))})}sourceChanged(t){return x(this,null,function*(){this.plan.code=t,yield this.store.updatePlan(this.plan),this.parseCode()})}parseCode(){if(this.plan.code&&this.plan.code.length>0){let t=te.tokenize(this.plan.code);if(t.length>0){let e=ee.parse(t);e.length>0&&(this.root=e[0],this.root.isExpanded=!0,this.current()&&this.current().keyValue().length>0?(this.current.set(this.root),this.expandUp(this.root,this.current())):this.current.set(this.root))}}else{this.root=new R,this.root.key=this.plan.key;let t=this.current();if(t&&t.keyValue().length>1){this.current.set(t);return}this.current.set(this.root)}}expandUp(t,e){if(e){let i=e.getValue("Key")?e.getValue("Key"):e.tokenType,a=t.flatten();for(let d of a)if(d.getValue("Key")===i||d.tokenType===i){this.current.set(d),d.isExpanded=!0,this.current().isExpanded=!0,this.current().parent&&this.current&&(this.current().parent.isExpanded=!0,this.current().parent.parent.isExpanded=!0,this.current().parent.parent.parent&&(this.current().parent.parent.parent.isExpanded=!0));break}}t.isExpanded=!0}setCurrent(t){this.current.set(t)}dataUpdated(t){return x(this,null,function*(){this.current()===t&&this.updateRoot({root:this.root,crnt:this.current()})})}updateRoot(t){return x(this,null,function*(){this.root===t.root?this.plan.code=U.convert(t.root):this.plan.code=U.convert(this.root),yield this.store.updatePlan(this.plan),this.parseCode()})}saveAndClose(t){return x(this,null,function*(){let e=t;this.customOn.set(!1),e.id&&(yield this.store.updateMenu(e),this.placeShapes())})}reindexItem(t){return x(this,null,function*(){let e=t.data,i=t.event;if(!e&&!e.id){this.placeShapes();return}switch(i){case"on-resize":e.config.maxWidth=e.w,e.config.maxHeight=e.h,yield this.store.updateMenu(e);break;case"on-index":e.zIndex=1;for(let a of this.menus())a!==a&&(a.zIndex=0);break;case"on-move":break;case"on-open":e.isOpen=!e.isOpen,yield this.store.updateMenu(e);break;case"on-tack":e.isTack=!e.isTack,yield this.store.updateMenu(e);break}this.placeShapes(),this.menu.set(e),this.rootMenu().placement==="auto"&&setTimeout(()=>{this.scrollToCurrent(e)},200)})}openMenuAndScroll(t){t.role!=="Root"&&(t.isOpen=!t.isOpen,this.placeShapes())}menuToggled(t){return x(this,null,function*(){if(!t.id)return;let e=t,i=this.menus().filter(d=>d.isOpen),a=i.findIndex(d=>d.id===e.id);e.isOpen=!e.isOpen,yield this.store.updateMenu(e),this.placeShapes(),e.isOpen||(a===i.length-1?(e=i[a-1],this.menu.set(e)):(e=i[a+1],this.menu.set(e))),setTimeout(()=>{this.scrollToCurrent(e)},500)})}loadMenus(t){return x(this,null,function*(){let e=yield this.store.getMenus();e.length===0&&(yield this.createNeededMenus(t),e=yield this.store.getMenus());let i=e.filter(a=>a.parentId===t).sort((a,d)=>a.order-d.order);i.length===0?(yield this.createNeededMenus(t),e=yield this.store.getMenus(),i=e.filter(a=>a.parentId===t).sort((a,d)=>a.order-d.order),this.menus.set(i)):this.menus.set(i),this.placeShapes()})}placeShapes(){this.maxW=window.innerWidth-20,this.w=window.innerWidth-20,this.h=window.innerHeight-20;let t=this.menus().filter(r=>r.isOpen),e=20;this.h=window.innerHeight-35;let i=12,a=5;this.maxW=0;let d=this.rootMenu();d||(this.createNeededMenus("Plan"),t=this.menus().filter(r=>r.isOpen),d=this.rootMenu()),d?.placement==="fixed"?t.forEach(r=>{(r.x===0||r.x===void 0||r.x<0)&&(r.x=i),(r.y===0||r.y===void 0||r.y<0)&&(r.y=a),(r.config.maxWidth===0||r.config.maxWidth===void 0||r.config.maxWidth<0)&&(r.config.maxWidth=350),(r.config.maxHeight===0||r.config.maxHeight===void 0||r.config.maxHeight<0)&&(r.config.maxHeight=350),r.w=r.config.maxWidth,r.h=r.config.maxHeight,this.maxW+=r.w+e,i+=r.w+e}):t.forEach(r=>{(r.config.maxWidth===0||r.config.maxWidth===void 0||r.config.maxWidth<0)&&(r.config.maxWidth=350),(r.config.maxHeight===0||r.config.maxHeight===void 0||r.config.maxHeight<0)&&(r.config.maxHeight=350),r.w=r.config.maxWidth,r.x=i,r.h=this.h-e*3,r.y=a,i+=r.w+e,this.maxW+=r.w+e}),this.maxW<this.w&&(this.maxW=this.w),this.maxW+=100}createNeededMenus(t){return x(this,null,function*(){let e=new w;e.id=T.newid(),e.role="Root",e.text="Root",e.parentId=t,e.order=0,e.isOpen=!1,e.config.maxWidth=350,e.config.maxHeight=0,e.placement="auto";let i=new w;i.id=T.newid(),i.x=10,i.y=10,i.role="Builder",i.text="Builder",i.parentId=t,i.order=1,i.isOpen=!0,i.config.maxWidth=350;let a=new w;a.id=T.newid(),a.role="Picker",a.text="Picker",a.parentId=t,a.order=2,a.isOpen=!1,a.config.maxWidth=350;let d=new w;d.id=T.newid(),d.role="Diagram",d.text="Diagram",d.parentId=t,d.order=3,d.isOpen=!1,d.config.maxWidth=350;let r=new w;r.id=T.newid(),r.role="Edit",r.text="Edit",r.parentId=t,r.order=4,r.isOpen=!1,r.config.maxWidth=350;let C=new w;C.id=T.newid(),C.role="Canvas",C.text="Canvas",C.parentId=t,C.order=5,C.isOpen=!0,C.config.maxWidth=750;let v=new w;v.id=T.newid(),v.role="Runner",v.text="Runner",v.parentId=t,v.order=6,v.isOpen=!1,v.config.maxWidth=350;let y=[];y.push(e),y.push(i),y.push(a),y.push(d),y.push(r),y.push(C),y.push(v);for(let le of y)yield this.store.createMenu(le)})}scrollToCurrent(t){if(this.rootMenu().placement==="auto"){let e=t.id,i=document.querySelector(".project-container");i&&i.scrollTo({left:t.x,behavior:"smooth"})}}};l.\u0275fac=function(e){return new(e||l)(k(Q),k(de),k(L),k(N))},l.\u0275cmp=$({type:l,selectors:[["plan-detail"]],standalone:!0,features:[z],decls:22,vars:13,consts:[[1,"plan"],[1,"plan-header"],[1,"header-btns"],[1,"image-btn",3,"routerLink"],[1,"icon"],[1,"plan-container"],[1,"non-pannable-svg"],[1,"rightbar"],[1,"fab"],[1,"fab-btn",3,"click"],[3,"data"],[1,"permanent","glass"],["menu-holder","",3,"data","current"],["menu-holder","",3,"reIndexed","data","current"],[3,"maxHeight","overflowY"],[3,"data","h","current"],[3,"data","current","w","h"],[3,"data","root","w","h"],[3,"root"],[1,"gridcards"],[3,"dataChanged","onClicked","data"],[3,"itemChanged","rootUpdated","sourceChanged","data","h","current"],[3,"rootUpdated","itemChanged","data","current","w","h"],[3,"dataEdited","data","root","w","h"],[3,"menuToggled","data"],[3,"dataChanged","data"]],template:function(e,i){e&1&&(c(0,"div",0)(1,"div",1),I(2,"button"),c(3,"span"),E(4),p(),c(5,"div",2)(6,"button",3)(7,"span",4),E(8,"arrow_back"),p(),E(9),p()()(),c(10,"div",5),W(),c(11,"svg",6),D(12,Ce,1,1,null,null,M),p()(),O(),c(14,"div",7)(15,"div",8)(16,"button",9),f("click",function(){return i.customOn.set(!i.customOn())}),c(17,"span",4),E(18,"settings"),p()()(),D(19,ve,1,1,"menu-toggle",10,M),p()(),S(21,ye,2,1,"div",11)),e&2&&(_(4),H("Plan: ",i.plan.key,""),_(2),m("routerLink",B(12,ce)),_(3),H(" ",i.plan.key," "),_(),P("max-width",i.w,"px")("max-height",i.h,"px"),_(),P("width",i.maxW,"px")("height",i.h,"px"),_(),F(i.menus()),_(7),F(i.menus()),_(2),b(i.customOn()&&i.menu().role!==""?21:-1))},dependencies:[G,K,X,Z,ie,q,ne,re,oe,ae,se],styles:[`.plan{display:grid;grid-template-areas:"plan-header" "plan-container";grid-template-rows:32px auto;height:100%;width:100%;overflow:hidden;padding:0;margin:0;-webkit-user-select:none;user-select:none}.plan-header{grid-area:plan-header;display:flex;gap:14px;overflow:hidden;min-height:30px;padding-top:2px;flex-direction:row;flex-wrap:nowrap;justify-content:space-between;color:var(--text-color);align-items:center}.plan-container{grid-area:plan-container;overflow-y:hidden;overflow-x:auto;scroll-snap-align:center;height:100%;width:100%}.permanent{position:fixed;top:30px;right:71px;z-index:100;margin:0rem;padding:0rem;height:300px;width:255px;background-color:var(--primary-color);border-radius:5px;color:var(--text-color);overflow-y:auto;overflow-x:hidden}.non-pannable-svg{overflow:hidden}
`],encapsulation:2});let o=l;return o})();export{Qe as PlanDetail};
