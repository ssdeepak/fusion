import{h as n,y as m}from"./chunk-TL3SOKZG.js";import{a as c,b as x}from"./chunk-FB7CDEED.js";import{Ia as g,L as w,Q as y,j as d,k as G,n as b,v as l}from"./chunk-XIWENJHJ.js";import{i as a}from"./chunk-BL3FZZIZ.js";var f=class{constructor(){this.useLocalDb=!0}};var $=(()=>{let o=class o extends f{constructor(r,t){super(),this._httpClient=r,this.store=t,this.isWaiting=g(!1),this.groups=g([]),this.groupedGroups=g([]),this.isWaiting.set(!0),this.getGroups()}getGroups(){return a(this,null,function*(){if(this.isWaiting.set(!0),this.groups.set(new Array),this.groupedGroups.set(new Array),this.useLocalDb){let r=yield this.store.readGroups();return this.groups.set(r),this.buildGroupedGroups(),this.isWaiting.set(!1),r}else return this._httpClient.get("api/groups/").pipe().subscribe(r=>{if(!(r==null||r.length===0)){var t=new Array;for(let e=0;e<r.length;e++){var s=r[e];t.push(new n().fromJson(s))}return this.groups.set(t),this.buildGroupedGroups(),t}})})}getLocalGroups(r){return a(this,null,function*(){return this.groups().length===0&&(yield this.getGroups()),this.groups().filter(e=>e.category===r)})}getGroupCategory(r){if(this.useLocalDb){let e=this.groups().filter(i=>i.category===r);var t=new Array;for(let i=0;i<e.length;i++){var s=e[i];t.push(new n().fromJson(s))}return d(this.addRootAndGroup(t))}else return this._httpClient.get(`api/groups/${r}`).pipe(b(e=>{if(e==null||e.length===0)return new Array;var i=new Array;for(let u=0;u<e.length;u++){var p=e[u];i.push(new n().fromJson(p))}return this.addRootAndGroup(i)}))}createGroup(r){return a(this,null,function*(){if(this.useLocalDb){yield this.store.createGroup(r);let t=yield this.store.readGroups();return this.groups.set(t),this.buildGroupedGroups(),this.isWaiting.set(!1),!0}else{let t=JSON.stringify(r.toJson()),s={headers:new c({"Content-Type":"application/json"})};return this._httpClient.post("api/groups/create",t,s).pipe(l(i=>(alert(i),d(!1)))).subscribe(i=>{if(i){alert("Group created successfully");var p=new n().fromJson(i);this.groups.set([...this.groups(),p]),this.buildGroupedGroups()}})}})}updateGroups(){return a(this,null,function*(){if(this.useLocalDb){yield this.store.upsertGroups(this.groups());let s=yield this.store.readGroups();return this.groups.set(s),this.buildGroupedGroups(),this.isWaiting.set(!1),!0}else{var r=this.groups(),t=JSON.stringify(r.map(e=>e.toJson()));return this._httpClient.put("api/groups/updatemany/",t,{headers:new c({"Content-Type":"application/json"})}).pipe(l(this.handleError)).subscribe(e=>{var i=new Array;for(let u=0;u<e.length;u++){var p=e[u];i.push(new n().fromJson(p))}this.groups.set(i),this.buildGroupedGroups()})}})}updateGroup(r){return a(this,null,function*(){if(this.useLocalDb){this.store.updateGroup(r);let t=yield this.store.readGroups();return this.groups.set(t),this.buildGroupedGroups(),this.isWaiting.set(!1),!0}else{let t=JSON.stringify(r.toJson()),s=`api/groups/update/${r.id}`;return this._httpClient.put(s,t,{headers:new c({"Content-Type":"application/json"})}).pipe(l(this.handleError)).subscribe(e=>(e&&this.buildGroupedGroups(),!0))}})}deleteGroup(r,t){return a(this,null,function*(){if(this.useLocalDb){yield this.store.deleteGroup(t);let s=yield this.store.readGroups();return this.groups.set(s),this.buildGroupedGroups(),this.isWaiting.set(!1),!0}else return this._httpClient.delete(`api/groups/delete/${t}`).pipe().subscribe(s=>s?(this.groups.set(this.groups().filter(e=>e.id!==t)),this.buildGroupedGroups(),!0):!1)})}addRootAndGroup(r){var t=new Array;for(let e of r)if(e.category&&e.parentKey===""){var s=!1;for(let i of t)if(i.category===e.category){s=!0;break}s||t.push(e)}for(let e of t)e.groups=new Array,this.assignSubGroups(e,r);return t}buildGroupedGroups(){this.isWaiting.set(!0),this.groupedGroups.set(new Array);var r=new Array,t=new n;t.category="",t.color="white",t.key="All",t.id="all",t.description="| display all",t.parentKey="",t.parent=null,r.push(t);for(let e of this.groups())if(e.category&&e.parentKey===""){var s=!1;for(let i of r)if(i.category===e.category){s=!0;break}s||r.push(e)}for(let e of r)e.groups=new Array,this.assignSubGroups(e,this.groups());this.groupedGroups.set(r),this.isWaiting.update(e=>!e)}assignSubGroups(r,t){for(let s of t)s.category===r.category&&s!==r&&s.parentKey===r.key&&(r.groups.push(s),s.parent=r,this.assignSubGroups(s,t))}newid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let t=Math.random()*16|0;return(r==="x"?t:t&3|8).toString(16)})}handleError(r){return r.error instanceof ErrorEvent?alert("An error occurred:"+r.error.message):alert(`Backend returned code ${r.status}, body was: ${r.error}`),alert(" return an observable with a user-facing error message"),G(()=>new Error("Something bad happened; please try again later."))}};o.\u0275fac=function(t){return new(t||o)(y(x),y(m))},o.\u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"});let h=o;return h})();export{f as a,$ as b};
