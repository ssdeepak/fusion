import{x as y,y as _}from"./chunk-TL3SOKZG.js";import{o as Y}from"./chunk-2UOGX6KS.js";import{Oa as v,V as k,Za as b,_a as S,ba as f,ca as w,cb as A,db as E,ib as R,jb as C,kb as P,yb as X,za as T}from"./chunk-XIWENJHJ.js";import"./chunk-BL3FZZIZ.js";var d=class{constructor(t,l,i,n,s){this.id=t,this.x=l,this.y=i,this.fill=n,this.stroke=s,this.width=0,this.height=0,this.radius=0,this.radiusX=0,this.radiusY=0,this.shapeType="",this.children=[],this.text="",this.isSelected=!1,this.parent=null}setHeight(t){return this.height=t,this}setRadiusX(t){return this.radiusX=t,this}setRadiusY(t){return this.radiusY=t,this}setShapeType(t){return this.shapeType=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setText(t){return this.text=t,this}setFill(t){return this.fill=t,this}setStroke(t){return this.stroke=t,this}setWidth(t){return this.width=t,this}setRadius(t){return this.radius=t,this}move(t,l){this.x+=t,this.y+=l,this.children.forEach(i=>{i.move(t,l)})}animate(t,l,i){this.x+=l,this.y+=i,this.draw(t)}draw(t){t.lineWidth=this.isSelected?4:1,this.shapeType==="circle"?H(t,this):this.shapeType==="rectangle"?I(t,this):this.shapeType==="triangle"?V(t,this):this.shapeType==="ellipse"?D(t,this):this.shapeType==="text"&&W(t,this),this.children.length>0&&this.children.forEach(l=>{F(t,this,l),l.draw(t)})}};var H=(e,t)=>{e.beginPath(),e.arc(t.x,t.y,t.radius,0,2*Math.PI),e.strokeStyle=t.stroke,e.fill(),e.stroke()},I=(e,t)=>{e.strokeStyle=t.stroke,e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowBlur=10,e.shadowOffsetX=5,e.shadowOffsetY=5,e.fillRect(t.x,t.y,t.width,t.height),e.strokeRect(t.x,t.y,t.width,t.height),e.shadowColor="transparent",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0},V=(e,t)=>{e.strokeStyle=t.stroke,e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.x+t.width,t.y),e.lineTo(t.x+t.width,t.y+t.height),e.closePath(),e.fill(),e.stroke()},D=(e,t)=>{e.beginPath(),e.ellipse(t.x,t.y,t.radiusX,t.radiusY,0,0,2*Math.PI),e.strokeStyle=t.stroke,e.fill(),e.stroke()},F=(e,t,l)=>{e.strokeStyle=t.stroke,e.beginPath();let i,n;t.shapeType==="circle"?(i=t.x,n=t.y):(i=t.x+t.width/2,n=t.y+t.height/2),e.moveTo(i,n);let s=i+(l.x-i)/3,h=n,o=i+2*(l.x-i)/3,a=l.y;e.bezierCurveTo(s,h,o,a,l.x,l.y),e.stroke()},W=(e,t)=>{e.beginPath(),e.strokeStyle=t.stroke,e.fillText(t.text,t.x,t.y),e.fill(),e.stroke()};var B=["canvas"],U=(()=>{let t=class t{constructor(i){this.store=i,this.width=1333,this.height=1444,this.asts=[],this.flatt=[],this.current=null,this.prevAsts=this.asts,this.animate=()=>{this.ctx.clearRect(0,0,this.width,this.height),this.asts.forEach(s=>{s.animate(this.ctx,1,1),s.draw(this.ctx)}),requestAnimationFrame(this.animate)},this.drawAllAsts=s=>{this.asts.forEach(h=>h.draw(s))},this.flatten=s=>{let h=[];return s.forEach(o=>this.flt(o,h)),h},this.flt=(s,h)=>{if(s&&(h.push(s),!!s.children&&s.children.length!==0))for(let o of s.children)this.flt(o,h)},this.isInsideAst=(s,h,o)=>{if(s.shapeType==="rectangle"||s.shapeType==="triangle"||s.shapeType==="ellipse")return h>=s.x&&h<=s.x+s.width&&o>=s.y&&o<=s.y+s.height;{let a=h-s.x,r=o-s.y;return a*a+r*r<=s.radius*s.radius}},this.handleDblClick=s=>{let o=s.target.getBoundingClientRect(),a=s.clientX-o.left,r=s.clientY-o.top;if(this.current){let p=this.current.children.length+1,u=this.current.id+p+"handle",c=new d(u,a,r,"black","pink");c.parent=this.current,c.shapeType="circle",c.x=a+100,c.y=r+100,c.radius=25,this.current.children.push(c),this.asts.push(c),this.drawAllAsts(this.ctx)}else{let p="a",u=new d(p,a,r,"black","pink");u.shapeType="circle",u.radius=25,this.asts.push(u),this.drawAllAsts(this.ctx)}};let n=[new d("a",50,50,"white","black").setShapeType("circle").setRadius(20),new d("b",300,50,"gray","black").setShapeType("circle").setRadius(20),new d("c",50,100,"yellow","black").setShapeType("circle").setRadius(10),new d("d",100,300,"purple","black").setShapeType("circle").setRadius(20),new d("e",120,230,"blue","black").setShapeType("triangle").setWidth(33).setHeight(44),new d("f",160,200,"pink","blue  ").setShapeType("triangle").setWidth(22).setHeight(44),new d("g",200,300,"green","black").setShapeType("rectangle").setWidth(44).setHeight(33)];for(let s of n)s.setFill(y.getAColor()),s.setStroke(y.getAColor())}ngAfterViewInit(){let i=this.canvas.nativeElement.getContext("2d");i&&(this.ctx=i),this.prevAsts!==this.asts&&(this.flatt=this.flatten(this.asts),this.prevAsts=this.asts),this.ctx&&(this.ctx.clearRect(0,0,this.width,this.height),this.drawAllAsts(this.ctx))}handleMouseDown(i){let s=i.target.getBoundingClientRect(),h=i.clientX-s.left,o=i.clientY-s.top;for(let a=this.asts.length-1;a>=0;a--){let r=this.asts[a];if(this.isInsideAst(r,h,o)){let p=h-r.x,u=o-r.y;r.isSelected=!r.isSelected,this.current=r,r.parent&&(r.parent.isSelected=!0);let c=g=>{let M=g.clientX-s.left-p,x=g.clientY-s.top-u;r.move(M-r.x,x-r.y),this.ctx.clearRect(0,0,this.width,this.height),this.drawAllAsts(this.ctx)},m=()=>{document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",m)};document.addEventListener("mousemove",c),document.addEventListener("mouseup",m);break}}}};t.\u0275fac=function(n){return new(n||t)(T(_))},t.\u0275cmp=k({type:t,selectors:[["home-paper"]],viewQuery:function(n,s){if(n&1&&R(B,7),n&2){let h;C(h=P())&&(s.canvas=h.first)}},inputs:{width:"width",height:"height",asts:"asts",flatt:"flatt",current:"current"},standalone:!0,features:[X],decls:2,vars:2,consts:[["canvas",""],[2,"border","1px solid black",3,"pointerdown","dblclick"]],template:function(n,s){if(n&1){let h=A();b(0,"canvas",1,0),E("pointerdown",function(a){return f(h),w(s.handleMouseDown(a))})("dblclick",function(a){return f(h),w(s.handleDblClick(a))}),S()}n&2&&v("width",s.width)("height",s.height)},dependencies:[Y]});let e=t;return e})();export{U as HomePaper};
